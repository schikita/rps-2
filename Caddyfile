rps-game.ru {
    # Direct routing for backend prefixes (RELIABLE)
    handle /api* {
        reverse_proxy backend:3000
    }
    handle /auth* {
        reverse_proxy backend:3000
    }
    handle /health* {
        reverse_proxy backend:3000
    }
    handle /socket.io* {
        reverse_proxy backend:3000 {
            header_up Host {host}
            header_up X-Real-IP {remote_host}
            header_up X-Forwarded-For {remote_host}
            header_up X-Forwarded-Proto {scheme}
            # WebSocket support
            header_up Connection {>Connection}
            header_up Upgrade {>Upgrade}
        }
    }

    # Everything else goes to the frontend
    handle {
        reverse_proxy cyber-rps:80
    }

    log {
        output file /var/log/caddy/access.log
    }
}

:80 {
    reverse_proxy cyber-rps:80
}
